<!DOCTYPE html>
<html lang="vi" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tool T·ª± ƒë·ªông ƒêi·ªÅn Google Form (Spring Boot & Thymeleaf)</title>
    <!-- T·∫£i Tailwind CSS ƒë·ªÉ c√≥ giao di·ªán ƒë·∫πp -->
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f7f7f7;
        }
    </style>
</head>
<body class="bg-gray-50 flex items-center justify-center min-h-screen">

<div class="mx-auto p-4 md:p-8 max-w-lg w-full">
    <div class="bg-white p-6 md:p-10 rounded-xl shadow-2xl border border-blue-100">
        <h1 class="text-3xl font-extrabold text-gray-800 mb-6 border-b pb-3 text-center">
            ü§ñ Google Form Spammer
        </h1>
        <p class="text-sm text-gray-600 mb-6">
            S·ª≠ d·ª•ng Thymeleaf (Frontend) ƒë·ªÉ g·ªçi API Spring Boot (Backend) th·ª±c hi·ªán t·ª± ƒë·ªông h√≥a v·ªõi Playwright.
        </p>

        <form id="spamForm" class="space-y-6">

            <div>
                <label for="formUrl" class="block text-sm font-medium text-gray-700 mb-2">
                    URL Google Form C√¥ng khai
                </label>
                <input type="url" id="formUrl" required
                       value="https://docs.google.com/forms/d/e/1FAIpQLScXG30q5h_wX4Fv7O4JcM8f0vP-Oq1kY7lA-Yg4nE/viewform"
                       placeholder="Nh·∫≠p link Form, v√≠ d·ª•: https://docs.google.com/forms/d/e/..."
                       class="w-full p-3 border border-gray-300 rounded-lg focus:ring-blue-500 focus:border-blue-500 transition duration-150 shadow-inner">
                <p class="text-xs text-gray-500 mt-1">S·ª≠ d·ª•ng URL `viewform`.</p>
            </div>

            <div>
                <label for="numSubmissions" class="block text-sm font-medium text-gray-700 mb-2">
                    S·ªë l·∫ßn g·ª≠i t·ª± ƒë·ªông (N)
                </label>
                <input type="number" id="numSubmissions" required min="1" max="100" value="3"
                       class="w-full p-3 border border-gray-300 rounded-lg focus:ring-blue-500 focus:border-blue-500 transition duration-150 shadow-inner">
                <p class="text-xs text-gray-500 mt-1">Khuy·∫øn ngh·ªã kh√¥ng qu√° 10 l·∫ßn cho m·ª•c ƒë√≠ch th·ª≠ nghi·ªám.</p>
            </div>

            <button type="submit" id="submitBtn"
                    class="w-full py-3 px-4 bg-blue-600 hover:bg-blue-700 text-white font-semibold rounded-lg shadow-lg transform transition duration-200 ease-in-out hover:scale-[1.01] active:scale-[0.98] disabled:bg-gray-400 disabled:cursor-not-allowed">
                B·∫ÆT ƒê·∫¶U T·ª∞ ƒê·ªòNG G·ª¨I
            </button>
        </form>

        <!-- Khung hi·ªÉn th·ªã k·∫øt qu·∫£ -->
        <div id="message" class="mt-8 p-4 rounded-lg text-sm transition-opacity duration-300 opacity-0 hidden"></div>
    </div>
</div>

<!-- JavaScript ƒë·ªÉ g·ªçi API Spring Boot -->
<script>
    document.addEventListener('DOMContentLoaded', () => {
        const form = document.getElementById('spamForm');
        const submitBtn = document.getElementById('submitBtn');
        const messageDiv = document.getElementById('message');

        // API endpoint m√† b·∫°n ƒë√£ ƒë·ªãnh nghƒ©a trong FormController
        const API_URL = '/api/form/submit';

        // H√†m hi·ªÉn th·ªã th√¥ng b√°o
        function showMessage(text, isError = false) {
            messageDiv.textContent = text;
            messageDiv.classList.remove('hidden', 'opacity-0');
            messageDiv.classList.add('opacity-100');
            if (isError) {
                messageDiv.className = 'mt-8 p-4 rounded-lg text-sm transition-opacity duration-300 opacity-100 bg-red-100 text-red-700 font-medium';
            } else {
                messageDiv.className = 'mt-8 p-4 rounded-lg text-sm transition-opacity duration-300 opacity-100 bg-green-100 text-green-700 font-medium';
            }
        }

        // H√†m ·∫©n th√¥ng b√°o
        function hideMessage() {
            messageDiv.classList.remove('opacity-100');
            messageDiv.classList.add('opacity-0');
            setTimeout(() => {
                messageDiv.classList.add('hidden');
            }, 300);
        }

        form.addEventListener('submit', async (e) => {
            e.preventDefault();
            hideMessage();

            const formUrl = document.getElementById('formUrl').value;
            const numSubmissions = parseInt(document.getElementById('numSubmissions').value);

            if (!formUrl || numSubmissions <= 0) {
                showMessage("Vui l√≤ng nh·∫≠p ƒë·∫ßy ƒë·ªß v√† ch√≠nh x√°c th√¥ng tin.", true);
                return;
            }

            submitBtn.disabled = true;
            submitBtn.textContent = 'ƒêang x·ª≠ l√Ω... (Ki·ªÉm tra Console Spring Boot)';
            showMessage("ƒêang g·ª≠i y√™u c·∫ßu ƒë·∫øn Backend. Qu√° tr√¨nh t·ª± ƒë·ªông h√≥a ƒë√£ b·∫Øt ƒë·∫ßu.", false);

            const payload = {
                formUrl: formUrl,
                numSubmissions: numSubmissions
            };

            try {
                const response = await fetch(API_URL, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(payload)
                });

                const responseText = await response.text();

                if (response.ok) {
                    showMessage(`‚úÖ TH√ÄNH C√îNG: ${responseText}`, false);
                } else {
                    // X·ª≠ l√Ω l·ªói t·ª´ Backend (4xx ho·∫∑c 5xx)
                    showMessage(`‚ùå L·ªñI [${response.status}]: ${responseText}`, true);
                }
            } catch (error) {
                // L·ªói kh√¥ng th·ªÉ k·∫øt n·ªëi t·ªõi Backend (r·∫•t hi·∫øm trong Thymeleaf v√¨ c√πng server)
                console.error('L·ªói k·∫øt n·ªëi API:', error);
                showMessage(`L·ªñI H·ªÜ TH·ªêNG: Kh√¥ng th·ªÉ g·ªçi API ${API_URL}. Chi ti·∫øt xem trong console.`, true);
            } finally {
                submitBtn.textContent = 'B·∫ÆT ƒê·∫¶U T·ª∞ ƒê·ªòNG G·ª¨I';
                submitBtn.disabled = false;
            }
        });
    });
</script>
</body>
</html>